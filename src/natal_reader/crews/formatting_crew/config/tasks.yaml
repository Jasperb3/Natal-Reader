markdown_enhancement_task:
  description: >
    Your task is to finalize the astrological report for PDF rendering by performing two steps:

    1. Clean the Text

     - Remove all commentary, notes, or internal thinking left by previous contributors (i.e. everything before the title "# Natal Chart for {name}")
     This includes meta-text such as implementation plans, critiques, revision summaries, or editorial reasoning.
     - What remains should be only the polished final report content, ready for publication.

    2. Enhance with HTML Tags

    - Insert specific HTML tags into the Markdown text to activate styling defined in the astro_styling.css file.
    - Apply tags only where appropriate, based on the structure and content of the report.
    - **Do not** alter the report's content, wording, order, or meaning.
    - **Do not** omit any report content (except the commentary removed in step 1).
    - **Do not** wrap the output in markdown code blocks or surround it with triple backticks.
    - **Do not** place tags around the [natal_chart] placeholder.
    - Glyphs should be added only once, after the first use of the planetary or sign name. Do not repeat glyphs with every instance.
    - Tables must include a <caption> and use <table class="planet-table">.
    - Glossary entries must be placed outside interpretation boxes and do not receive symbol spans.

    The output must be clean, publication-ready Markdown with inline HTML, suitable for direct conversion to a styled PDF.

    Apply the following HTML tagging rules using available CSS features:

    ğŸ”¹ Headings
    - Convert h2 headers (##) to: <h2 id="section-name">Heading Text</h2>
      (ID is generated by lowercasing the text, removing punctuation, and replacing spaces with dashes).
      This triggers a page break before the section and keeps the following content together.
    - Convert h3, h4, h5, h6 to <h3> through <h6> respectively.

    ğŸ”¹ Interpretation Boxes
    - Wrap key insights in:
      <div class="interpretation-box">...</div>
      These will be emphasized with background and margin styling and visually grouped with the header above.
    - Do **not** wrap <div class="interpretation-box"> elements inside list tags (<ol> or <li>).
      Instead, present each interpretation as its own standalone <div class="interpretation-box">.
      Each box should be visually and structurally separated from others by spacing, not bullet/number formatting.

    ğŸ”¹ Planet Names (color-coded spans)
    - Replace full planetary names (Sun, Moon, Mars, etc.) with:
      <span class="planet-name">Planet</span>
      Supported classes: sun, moon, mercury, venus, mars, jupiter, saturn, uranus, neptune, pluto

    ğŸ”¹ Planetary Glyphs
    - Add Unicode panetary glyphs in parentheses after the first instance of the planetary name in the report.
    - Wrap them in:
      <span class="astro-symbol">â˜‰</span>
    - Do **not** include <span class="planet-name"> tags within the planetary glyphs.
      Example:
      Sun â†’ <span class="planet-name">Sun</span><span class="astro-symbol"> (â˜‰)</span>
    - The glyphs are:
      - Sun: â˜‰
      - Moon: â˜½
      - Mercury: â˜¿
      - Venus: â™€
      - Mars: â™‚
      - Jupiter: â™ƒ
      - Saturn: â™„
      - Uranus: â™…
      - Neptune: â™†
      - Pluto: â™‡
      - Earth: âŠ• (alternate: â™)
      - Ceres: âš³
      - Chiron: âš·
      - North Node: â˜Š
      - South Node: â˜‹
      - Part of Fortune: âŠ—
      - Ascendant: AS
      - Midheaven: MC

    ğŸ”¹ Zodiac Signs (Glyphs)
    - Add the appropriate Unicode glyph after the textual sign names (e.g. "Aries", "Pisces").
    - Wrap the glyph in a span using the .sign-* class.
      Example:
      Aries â†’ <span class="sign-aries">Aries (â™ˆ)</span>
    - Available signs:
      - Aries: â™ˆ
      - Taurus: â™‰
      - Gemini: â™Š
      - Cancer: â™‹
      - Leo: â™Œ
      - Virgo: â™
      - Libra: â™
      - Scorpio: â™
      - Sagittarius: â™
      - Capricorn: â™‘
      - Aquarius: â™’
      - Pisces: â™“

    ğŸ”¹ Aspect Symbols
    - Add the appropriate Unicode glyph after the aspect words (e.g. "trine", "square", "opposition").
    - Wrap them in <span> using the appropriate .aspect-* class.
      Example:
      "trine" â†’ <span class="aspect-trine">Trine (Î”)</span>

    - Supported aspects and corresponding spans:
      - Conjunction: <span class="aspect-conjunction">Conjunction (â˜Œ)</span>
      - Opposition: <span class="aspect-opposition">Opposition (â˜)</span>
      - Square: <span class="aspect-square">Square (â˜)</span>
      - Trine: <span class="aspect-trine">Trine (Î”)</span>
      - Quincunx: <span class="aspect-quincunx">Quincunx (âŠ¼)</span>

    ğŸ”¹ Strength Levels
    - Wrap strength labels in:
      <span class="very-strong">very strong</span>,
      <span class="strong">strong</span>,
      <span class="moderate">moderate</span>,
      <span class="weak">weak</span>,
      <span class="very-weak">very weak</span>

    ğŸ”¹ Tables
    - Replace Markdown tables with:
      <table class="planet-table">...</table>
    - Use <caption> for a title, <th> for headers, and <td> for data cells.

    ğŸ”¹ Aspect Keywords
    - Wrap keywords like "trine", "square", "conjunction" in:
      <span class="harmonious-aspect">trine</span>,
      <span class="challenging-aspect">square</span>,
      <span class="neutral-aspect">conjunction</span>

    ğŸ”¹ Quotes or Reflections
    - Wrap emotional or philosophical passages in:
      <blockquote>...</blockquote>

    ğŸ”¹ Charts or Distribution Graphs
    - Wrap custom chart blocks in:
      <div class="chart-container">...</div>

    ğŸ”¹ Horizontal Section Breaks
    - Insert <hr class="section-break"/> between major conceptual transitions (e.g., from signs to elements)

    ğŸ”¹ Glossary Formatting
    - Use <div class="definition-term">Term</div><div class="definition-desc">Explanation</div>
      when listing terms and their meanings.
    - Do **not** include <span class="planet-name"> tags within the glossary.

    ğŸ”¹ Lists and Structure
    - Ensure bullet lists use <ul><li>...</li></ul> and numbered lists use <ol><li>...</li></ol>
    - Do not use Markdown table or list formatting; always convert to HTML structure.

    Report to format:
    
    {report}

  expected_output: >
    A fully tagged version of the original Markdown with appropriate inline HTML tags as specified.
    All content must remain unchanged except for the removal of commentary and the addition of tags.
    The output must be clean Markdown with embedded HTML, suitable for direct PDF rendering.
  agent: markdown_enhancer
