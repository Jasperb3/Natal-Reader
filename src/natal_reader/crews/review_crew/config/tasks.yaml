review_task:
  description: >
    Carefully review the generated natal report with a critical and constructive lens to ensure it meets high standards for factual accuracy, interpretive depth, narrative clarity, psychological relevance, and structural integrity.

    Use the following astronomical chart data as ground truth to verify all
    factual claims in the report (degrees, aspects, house placements, dignities):

    {natal_chart}

    Your first evaluation pass must check factual accuracy against this data.
    Flag any discrepancies before evaluating interpretive quality.

    The goal is to identify specific areas for improvement in the report's interpretation and presentation for the reader. Maintain the perspective of a client-oriented report focused on psychological and humanistic astrological insights.

    Criteria Checklist: Evaluate the report against these points:
    * Factual Accuracy: Are all degrees, aspects, house placements, and dignities cited in the report accurate according to the chart data? Are any chart features mentioned that don't exist in the data? Are any chart features from the data omitted?
    * Interpretive Adequacy: Are the core chart elements (Sun, Moon, Ascendant, Chart Ruler, major aspects, stellia, dominant houses) meaningfully interpreted and connected? Is appropriate context given to planetary condition (sect, dignity, motion) where relevant to the narrative? Are symbolic patterns synthesized into coherent, relatable psychological themes? Are elemental balances, modality distributions, and house emphasis integrated where they support psychological insight or recurring themes?
    * Narrative Flow & Clarity: Do sections transition smoothly, building a coherent understanding? Is the language clear, engaging, and free from unnecessary jargon? Is interpretive content tailored to avoid repetition across different planetary or aspect sections?
    * Practical & Psychological Relevance: Are astrological symbols and patterns translated into relatable, real-world experiences or psychological dynamics? Do sections offering guidance or reflection provide actionable insights tied directly to the chart's indications?
    * Structural Integrity & Formatting: Does the report follow a logical structure? Is markdown used correctly for headers and subheadings? Is the [natal_chart] placeholder correctly included in the designated section? Are technical terms defined or explained where relevant? Is the glossary adequately tailored to terms used in the report?

    IMPORTANT: Your critique will be used by an enhancement agent to edit the
    report. To prevent unintended content loss:
    - Be SPECIFIC about what needs to change. Reference exact sections and quotes.
    - Explicitly state what should be PRESERVED. If a section is well-written
      but needs one correction, say "This section is strong — only correct X."
    - NEVER suggest wholesale section rewrites. Instead, suggest targeted edits.
    - End your critique with a "Content to Preserve" section listing the
      report's strongest elements that must NOT be cut during enhancement.

    Provide a structured critique with clear headings and specific, actionable bullet points. Be discerning, concise and direct.
    Your critique should serve as a precise guide for TARGETED EDITS, not a mandate for rewriting.

    Today's date is {today}
    Report:
    {report}
  expected_output: >
    A structured critique in markdown, formatted with headings and bullet points as specified, clearly identifying factual errors, interpretive omissions, redundancies, clarity issues, and actionable suggestions for enhancing the natal report's accuracy, depth, resonance, practical relevance, and flow.
  agent: critic


report_enhancement_task:
  description: >
    Enhance the natal report by applying the critic's feedback as TARGETED EDITS
    to the existing text. Your output must contain ALL original content plus
    improvements — the enhanced report should be LONGER than the original, not shorter.

    ============================================================
    CRITICAL: CONTENT PRESERVATION RULES
    ============================================================

    These rules are ABSOLUTE and override all other instructions:

    1. **NEVER delete a section or subsection** from the original report.
       Every section header (##) and subsection header (###) in the original
       MUST appear in the enhanced report.

    2. **NEVER delete a planetary breakdown.** If the original has subsections
       for Mercury, Venus, Mars, Jupiter, Saturn, Uranus, Neptune, Pluto,
       Chiron, Lilith, and the Lunar Nodes — ALL must remain in the enhanced report.

    3. **NEVER delete aspect listings with orb degrees.** If the original lists
       "Opposition Moon (5.3°)" under the Sun, keep it.

    4. **NEVER delete "Practical Guidance" or "Theme" blocks.** These are
       high-value content for the reader. You may improve their wording but
       must not remove them.

    5. **NEVER delete glossary terms.** You may add new terms but must keep
       all existing definitions.

    6. **NEVER delete decan descriptions or Lunar Node interpretations.**

    7. **NEVER summarize or condense existing paragraphs** into shorter
       versions. If a paragraph needs improvement, edit it in place — do not
       replace three sentences with one.

    If the critique says content is FACTUALLY WRONG, correct it in place.
    If the critique says content is REDUNDANT, rephrase to reduce repetition
    but do NOT delete the interpretive content — relocate or integrate it.

    ============================================================
    ENHANCEMENT WORKFLOW
    ============================================================

    Step 1: Read the critique and extract a numbered list of specific changes.
    Step 2: For EACH change, identify the exact location in the original report.
    Step 3: Apply each change surgically:
      - CORRECTION: Replace the incorrect claim with the correct one at that location.
      - ADDITION: Insert new content at the appropriate location, weaving it
        into surrounding paragraphs or adding a new subsection.
      - EXPANSION: Add depth to the existing text without removing what's there.
    Step 4: Verify that every section, subsection, planet breakdown, aspect
      listing, guidance point, and glossary term from the original still exists.

    ============================================================
    ENHANCEMENT GUIDELINES
    ============================================================

    - You may use search tools ONLY to verify or enrich existing interpretations.
    - Do NOT introduce new planetary placements, aspects, or chart features not
      in the original analysis or critique. Any new content must be supportable
      by the chart data provided.
    - Favor symbolic metaphors or life examples that mirror the placement's
      inherent polarity, process, or tension.
    - Maintain the report's voice, structure, and coherence.
    - Keep the tone emotionally intelligent, empowering, and insightful.

    **Output Instructions**:
    - Format in clean, modular markdown. Remove any unnecessary backticks or codeblocks.
    - Output ONLY the final, edited report text. No commentary or thinking process.
    - Preserve `[natal_chart]` placeholder.
    - The enhanced report MUST be at least as long as the original report.

    Ensure that the title block is formatted exactly as specified below:
        ```
        # Natal Chart for {name}
        Date of Report: {today}

        [natal_chart]

        **Date of Birth:** {date_of_birth}
        **Place of Birth:** {place_of_birth}
        ```

    Today's date is {today}

    Report:
    {report}
  expected_output: >
    The complete, enhanced natal report in clean markdown (without codeblocks).
    It MUST contain ALL sections, subsections, planetary breakdowns, aspect
    listings, practical guidance points, and glossary terms from the original
    report, plus the improvements from the critique integrated in place. The
    enhanced report should be at least as long as the original, typically longer.
    Output contains ONLY the final report text.
  agent: report_enhancer
